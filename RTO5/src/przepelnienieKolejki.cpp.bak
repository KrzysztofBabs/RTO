#include <Arduino.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "freertos/queue.h"

QueueHandle_t kolejka;



void TaskProducer(void *a){
  int wartoscDostarczana=0;
  for(;;){
    if(xQueueSend(kolejka,&wartoscDostarczana,1000)==pdPASS){
      
      Serial.print("wyslano ");
      Serial.println(wartoscDostarczana);
      wartoscDostarczana++;
      vTaskDelay(5000);
      
      
    }
    else{
      Serial.print("kolejka przepelniona ");
      Serial.print("aktualnie w kolejce: ");
      Serial.println(uxQueueMessagesWaiting(kolejka));
    }
  }
}


void TaskConsumer(void *a){
    vTaskDelay(15000);
  for(;;){
    int wartoscOdbierana;
    if(xQueueReceive(kolejka,&wartoscOdbierana,portMAX_DELAY)==pdPASS){
      Serial.print("odebrano ");
      Serial.println(wartoscOdbierana);
      Serial.print("ilosc elementow w kolejce po odebraniu: ");
      Serial.println(uxQueueMessagesWaiting(kolejka));
      vTaskDelay(15000);

    }
    
  }
}





void setup() {
  Serial.begin(9600);
  kolejka=xQueueCreate(5,sizeof(int));
  if(kolejka!=NULL){
    xTaskCreate(TaskProducer, "TP", 2048, NULL,1,NULL);
    xTaskCreate(TaskConsumer, "TC", 2048, NULL,1,NULL);
  }
  else{
    Serial.println("kolejka nie zostala utworzona\n");
  }

  
}

void loop() {
  
}

